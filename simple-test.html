<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NK Camp - 간단 테스트</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .status {
            background: #f0f0f0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #007cba;
        }
        
        .error {
            background: #fee;
            border-left-color: #e74c3c;
            color: #c0392b;
        }
        
        .success {
            background: #efe;
            border-left-color: #27ae60;
            color: #27ae60;
        }
        
        iframe {
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏢 NK Camp 라이브러리 로딩 테스트</h1>
        
        <div id="library-status">
            <div class="status">라이브러리 로딩 확인 중...</div>
        </div>
        
        <h2>1. 직접 embed.html 테스트</h2>
        <iframe src="./embed.html" width="100%" height="400px"></iframe>
        
        <h2>2. 다크 테마 테스트</h2>
        <iframe src="./embed.html?theme=dark" width="100%" height="400px"></iframe>
        
        <div id="console-log" style="background: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: monospace; margin: 20px 0; height: 200px; overflow-y: auto;">
            <div>Console Log:</div>
        </div>
    </div>

    <script>
        // CDN 라이브러리 로딩 테스트
        function testLibraries() {
            const statusDiv = document.getElementById('library-status');
            
            // React 테스트
            const reactScript = document.createElement('script');
            reactScript.src = 'https://unpkg.com/react@18/umd/react.production.min.js';
            reactScript.onload = function() {
                addStatus('✅ React 18 로딩 성공', 'success');
                
                // ReactDOM 테스트
                const reactDOMScript = document.createElement('script');
                reactDOMScript.src = 'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js';
                reactDOMScript.onload = function() {
                    addStatus('✅ ReactDOM 18 로딩 성공', 'success');
                    
                    // Recharts 테스트
                    const rechartsScript = document.createElement('script');
                    rechartsScript.src = 'https://unpkg.com/recharts@2.8.0/umd/Recharts.js';
                    rechartsScript.onload = function() {
                        addStatus('✅ Recharts 2.8.0 로딩 성공', 'success');
                        addStatus('🎉 모든 라이브러리 로딩 완료!', 'success');
                        testReactComponent();
                    };
                    rechartsScript.onerror = function() {
                        addStatus('❌ Recharts 로딩 실패', 'error');
                    };
                    document.head.appendChild(rechartsScript);
                };
                reactDOMScript.onerror = function() {
                    addStatus('❌ ReactDOM 로딩 실패', 'error');
                };
                document.head.appendChild(reactDOMScript);
            };
            reactScript.onerror = function() {
                addStatus('❌ React 로딩 실패', 'error');
            };
            document.head.appendChild(reactScript);
        }
        
        function addStatus(message, type = '') {
            const statusDiv = document.getElementById('library-status');
            const div = document.createElement('div');
            div.className = 'status ' + type;
            div.textContent = message;
            statusDiv.appendChild(div);
            
            // 콘솔에도 추가
            const consoleDiv = document.getElementById('console-log');
            const logLine = document.createElement('div');
            logLine.textContent = new Date().toLocaleTimeString() + ': ' + message;
            consoleDiv.appendChild(logLine);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function testReactComponent() {
            try {
                // 간단한 React 컴포넌트 테스트
                const testDiv = document.createElement('div');
                testDiv.id = 'react-test';
                document.body.appendChild(testDiv);
                
                const TestComponent = React.createElement('div', {
                    style: { 
                        background: '#e8f5e8', 
                        padding: '10px', 
                        border: '2px solid #27ae60',
                        borderRadius: '5px',
                        margin: '10px 0'
                    }
                }, '✅ React 컴포넌트 렌더링 성공!');
                
                const root = ReactDOM.createRoot(testDiv);
                root.render(TestComponent);
                
                addStatus('✅ React 컴포넌트 렌더링 테스트 성공', 'success');
                
                // Recharts 테스트
                if (typeof Recharts !== 'undefined') {
                    addStatus('✅ Recharts 객체 확인 완료', 'success');
                    addStatus('📊 사용 가능한 Recharts 컴포넌트: ' + Object.keys(Recharts).slice(0, 5).join(', '), 'success');
                } else {
                    addStatus('❌ Recharts 객체를 찾을 수 없음', 'error');
                }
                
            } catch (error) {
                addStatus('❌ React 컴포넌트 테스트 실패: ' + error.message, 'error');
            }
        }
        
        // 페이지 로드 시 테스트 시작
        window.addEventListener('load', function() {
            addStatus('🚀 라이브러리 로딩 테스트 시작');
            testLibraries();
            
            // iframe 메시지 리스너
            window.addEventListener('message', function(e) {
                if (e.data && e.data.type) {
                    addStatus('📨 iframe 메시지 수신: ' + JSON.stringify(e.data));
                }
            });
        });
        
        // 에러 캐치
        window.addEventListener('error', function(e) {
            addStatus('❌ JavaScript 에러: ' + e.message, 'error');
        });
    </script>
</body>
</html>